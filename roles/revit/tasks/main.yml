### Comando em powershell para mostrar product_id
### get-wmiobject Win32_Product | Format-Table IdentifyingNumber, Name, LocalPackage -AutoSize
### Localizacao do productid 32 bits: HKLM:Software\Microsoft\Windows\CurrentVersion\Uninstall
### Localizacao do productid 64 bits: HKLM:Software\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall


## Windows
- name: Verifica se o Revit 26 est√° instalado
  ansible.windows.win_stat:
    path: C:\Program Files\Autodesk\Revit 2026
  register: revit26_info
  changed_when: false
  when: ansible_os_family == 'Windows'

- name: Baixar zip do revit 26
  ansible.windows.win_get_url:
    url: http://ansiblefiles.sj.ifsc.edu.br/Revit_2026.zip
    dest: 'C:\instaladores\Revit_2026.zip'
    force: false
    timeout: 300 # 5 minutos
  when: ansible_os_family == 'Windows' and not revit26_info.stat.exists

- name: Extrai o Revit 26
  community.windows.win_unzip:
    src: C:\instaladores\Revit_2026.zip
    dest: C:\instaladores
  when: ansible_os_family == 'Windows' and not revit26_info.stat.exists

- name: Instalar o Revit 2026 - Windows
  ansible.windows.win_package:
    path: C:/instaladores/Revit 2026/Setup.exe
    arguments:
      - --mode
      - unattended
      - --ui_mode
      - basic
    # product_id: '{2427809E-E557-47DF-813D-22A52BC0E646}'
    state: present
  when: ansible_os_family == 'Windows' and not revit26_info.stat.exists

- name: Remove arquivos antigos
  ansible.windows.win_file:
    path: "{{ revit_files }}"
    state: absent
  loop:
    - C:\instaladores\Revit_2026.zip
    - C:\Autodesk\{7357F4C2-BA44-4FD9-88E4-96A55D0BBA59}
  loop_control:
    loop_var: revit_files
  when: ansible_os_family == 'Windows'
